<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-primary fw-bold">Staff Management</h2>

    <button class="btn btn-primary" (click)="showAdd = !showAdd">
      {{ showAdd ? 'Close' : 'Add Staff' }}
    </button>
  </div>

  <!-- Search -->
  <input
    class="form-control mb-3"
    placeholder="Search..."
    [(ngModel)]="searchQuery"
    (input)="applyFilters()"
  />

  <!-- Add Staff Form -->
  <div *ngIf="showAdd" class="card p-3 border-0 shadow-sm mb-3">
    <form [formGroup]="form" (ngSubmit)="addStaff()">

      <div class="row g-3">

        <div class="col-md-4">
          <label>Name</label>
          <input
            formControlName="name"
            class="form-control"
            [class.is-invalid]="f.name.touched && f.name.invalid"
          />
          <div *ngIf="f.name.touched && f.name.invalid" class="text-danger small">
            <div *ngIf="f.name.errors?.required">Name is required</div>
            <div *ngIf="f.name.errors?.minlength">Name must be at least 3 characters</div>
            <div *ngIf="f.name.errors?.pattern">Only letters and spaces allowed</div>
          </div>
        </div>

        <div class="col-md-4">
          <label>Username</label>
          <input
            formControlName="username"
            class="form-control"
            [class.is-invalid]="f.username.touched && f.username.invalid"
          />
          <div *ngIf="f.username.touched && f.username.invalid" class="text-danger small">
            <div *ngIf="f.username.errors?.required">Username is required</div>
            <div *ngIf="f.username.errors?.minlength">Username must be at least 3 characters</div>
            <div *ngIf="f.username.errors?.pattern">No spaces allowed in username</div>
          </div>
        </div>

        <div class="col-md-4">
          <label>Email</label>
          <input
            formControlName="email"
            class="form-control"
            [class.is-invalid]="f.email.touched && f.email.invalid"
          />
          <div *ngIf="f.email.touched && f.email.invalid" class="text-danger small">
            <div *ngIf="f.email.errors?.required">Email is required</div>
            <div *ngIf="f.email.errors?.email || f.email.errors?.pattern">Enter a valid email</div>
          </div>
        </div>

        <div class="col-md-4">
          <label>Mobile</label>
          <input
            type="tel"
            formControlName="mobile"
            class="form-control"
            maxlength="10"
            inputmode="numeric"
            pattern="\d*"
            (input)="allowNumbersOnly($event)"
            [class.is-invalid]="f.mobile.touched && f.mobile.invalid"
            placeholder=""
          />
          <div *ngIf="f.mobile.touched && f.mobile.invalid" class="text-danger small">
            <div *ngIf="f.mobile.errors?.required">Mobile is required</div>
            <div *ngIf="f.mobile.errors?.pattern">Enter a valid 10 digit mobile number</div>
          </div>
        </div>

        <div class="col-md-4">
          <label>Department</label>
          <input formControlName="department" class="form-control" readonly />
        </div>

      </div>

      <button class="btn btn-primary mt-3">
        Add Staff
      </button>
    </form>
  </div>

  <!-- Staff Table -->
  <table class="table table-hover shadow-sm">
    <thead>
      <tr>
        <th role="button" (click)="toggleSort('name')">Name</th>
        <th role="button" (click)="toggleSort('username')">Username</th>
        <th>Email</th>
        <th>Mobile</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let s of pageData">
        <td>{{ s.name }}</td>
        <td>{{ s.username }}</td>
        <td>{{ s.email }}</td>
        <td>{{ s.mobile }}</td>
        <td>
          <button class="btn btn-danger btn-sm" (click)="deleteStaff(s.id, s.name)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="d-flex gap-3 align-items-center mt-2">
    <button class="btn btn-outline-primary" (click)="changePage(page - 1)" [disabled]="page === 1">
      Prev
    </button>

    <span>Page {{page}} / {{totalPages}}</span>

    <button class="btn btn-outline-primary" (click)="changePage(page + 1)" [disabled]="page === totalPages">
      Next
    </button>
  </div>

</div>


<div class="modal fade" id="actionModalStaff" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">{{ modalTitle }}</h5>
        <button type="button" class="btn-close" (click)="modalCancel()"></button>
      </div>

      <div class="modal-body">
        <p [innerHTML]="modalMessage"></p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="modalCancel()">Cancel</button>
        <button type="button" class="btn btn-danger" (click)="modalConfirm()">Yes, Delete</button>
      </div>

    </div>
  </div>
</div>